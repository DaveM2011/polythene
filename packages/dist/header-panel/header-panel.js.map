{"version":3,"sources":["../../src/src/header-panel/header-panel.js"],"names":["CSS_CLASSES","panel","header","dropShadow","outerContainer","headerContainer","backgroundContainer","condensedBackground","headerBackground","mediaDimmer","mainContainer","headerAnimated","fixed","cascaded","modeCover","modeScroll","modeSeamed","modeStandard","modeTall","modeWaterfallTall","modeWaterfall","toolbar","toolbarTopbar","headerTall","DEFAULT_SHADOW_HEIGTH","DEFAULT_HEADER_HEIGHT","DEFAULT_CONDENSED_HEADER_HEIGHT","SCROLL_WATCH_TIMER","scroller","scrollPositions","modeConfigs","shadowAfterScroll","alwaysShadow","noShadow","tallMode","outerScroll","modeClasses","classForMode","mode","setTransform","document","documentElement","style","transform","undefined","string","webkitTransform","translateY","y","t","createHeaderComponent","opts","tall","tallClass","toolbarOpts","class","join","topBar","content","animated","createViewHeader","ctrl","initHeaderContainer","inited","headerContainerElem","headerConfig","config","shadow","createViewContent","scrollConfig","initMainContainer","main","scrollerElem","onscroll","e","emit","storeScrollPosition","target","scrollTop","createView","configs","init","updateContentOnScroll","ignoreContent","isScrolling","scrollerType","handleScroll","bind","tag","initOuterContainer","headerElem","querySelector","topBarElem","headerBg","condensedHeaderBg","outerContainerElem","headerTopBarElem","setHeight","clientHeight","outer","restoreScrollPosition","props","id","el","headerPanelElem","subtree","before","after","component","controller","scrolled","prevScrollTop","headerMargin","headerHeight","condenses","scrollAwayTopbar","noReveal","keepCondensedHeader","noDissolve","backgroundScrollSpeed","shadowHeight","condensedHeaderHeight","handleScrollFns","standard","isScrolled","showShadow","classList","dynamicHeader","sy","sTop","scrollInited","initialScrollPosition","initialPositionFixed","Math","min","max","transformHeader","isTouch","enlargeImage","handleScrollFn","scrollWatchId","h","paddingTop","clearTimeout","setTimeout","scroll","condenseHeader","hy","reset","hbg","opacity","chbg","height","condensedHeight","abs","restoreScrollPositionId","restore","view"],"mappings":"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","file":"header-panel.js","sourcesContent":["import '../common/object.assign';\nimport p from '../polythene/polythene';\nimport events from '../common/events';\nimport m from 'mithril';\nimport toolbar from '../toolbar/toolbar';\nimport './theme';\n\nconst CSS_CLASSES = {\n    panel: 'pe-header-panel',\n    header: 'pe-header',\n    dropShadow: 'pe-header-panel__drop-shadow',\n    outerContainer: 'pe-header-panel__outer-container',\n    headerContainer: 'pe-header-panel__header-container',\n    backgroundContainer: 'pe-header-panel__background-container',\n    condensedBackground: 'pe-header-panel__condensed-background',\n    headerBackground: 'pe-header-panel__header-background',\n    mediaDimmer: 'pe-header-panel__media-dimmer',\n    mainContainer: 'pe-header-panel__main-container',\n\n    headerAnimated: 'pe-header--animated',\n    fixed: 'pe-header-panel--fixed',\n    cascaded: 'pe-header-panel--cascaded',\n    modeCover: 'pe-header-panel--cover',\n    modeScroll: 'pe-header-panel--scroll',\n    modeSeamed: 'pe-header-panel--seamed',\n    modeStandard: 'pe-header-panel--standard',\n    modeTall: 'pe-header-panel--tall',\n    modeWaterfallTall: 'pe-header-panel--waterfall-tall',\n    modeWaterfall: 'pe-header-panel--waterfall',\n\n    // lookups:\n    toolbar: 'pe-toolbar',\n    toolbarTopbar: 'pe-toolbar__bar--top',\n    headerTall: 'pe-header--tall'\n};\n\nconst DEFAULT_SHADOW_HEIGTH = 6;\nconst DEFAULT_HEADER_HEIGHT = 192;\nconst DEFAULT_CONDENSED_HEADER_HEIGHT = DEFAULT_HEADER_HEIGHT / 3;\nconst SCROLL_WATCH_TIMER = 150;\n\nlet scroller; // keep track of scrolling elements on the page\nconst scrollPositions = {};\n\nconst modeConfigs = {\n    shadowAfterScroll: {\n        'waterfall': 1,\n        'waterfall-tall': 1\n    },\n    alwaysShadow: {\n        'standard': 1,\n        'tall': 1\n    },\n    noShadow: {\n        'seamed': 1,\n        'cover': 1,\n        'scroll': 1\n    },\n    tallMode: {\n        'tall': true,\n        'waterfall-tall': true\n    },\n    outerScroll: {\n        'scroll': 1\n    }\n};\n\nconst modeClasses = {\n    'cover': CSS_CLASSES.modeCover,\n    'scroll': CSS_CLASSES.modeScroll,\n    'seamed': CSS_CLASSES.modeSeamed,\n    'standard': CSS_CLASSES.modeStandard,\n    'tall': CSS_CLASSES.modeTall,\n    'waterfall-tall': CSS_CLASSES.modeWaterfallTall,\n    'waterfall': CSS_CLASSES.modeWaterfall\n};\n\nconst classForMode = (mode = 'standard') => {\n    return modeClasses[mode];\n};\n\nconst setTransform = (document.documentElement.style.transform !== undefined) ? ((style, string) => {\n    style.transform = string;\n}) : ((style, string) => {\n    style.webkitTransform = string;\n});\n\nconst translateY = (style, y) => {\n    const t = (y === null) ? '' : 'translate3d(0, ' + y + 'px, 0)';\n    setTransform(style, t);\n};\n\nconst createHeaderComponent = (opts = {}) => {\n    const tall = opts.tall || false;\n    const tallClass = opts.tallClass || '';\n    const toolbarOpts = opts.toolbar;\n    if (toolbarOpts) {\n        toolbarOpts.class = [\n            (toolbarOpts.class || null),\n            tall ? tallClass : null\n        ].join(' ');\n        if (!toolbarOpts.topBar) {\n            toolbarOpts.topBar = m('div');\n        }\n        return m(toolbar, toolbarOpts);\n    } else if (opts.content) {\n        return m('div', {\n            class: [\n                CSS_CLASSES.header,\n                (opts.class || null),\n                (tall ? tallClass : null),\n                (opts.animated ? CSS_CLASSES.headerAnimated : '')\n            ].join(' ')\n        }, opts.content);\n    } else {\n        return m('div', opts);\n    }\n};\n\nconst createViewHeader = (ctrl, opts = {}) => {\n    const initHeaderContainer = (headerContainer, inited) => {\n        if (inited) {\n            return;\n        }\n        ctrl.headerContainerElem = headerContainer;\n    };\n    const header = opts.header ? createHeaderComponent(Object.assign({}, opts.header, ctrl.headerConfig)) : null;\n    return m('div', {\n        class: CSS_CLASSES.headerContainer,\n        config: initHeaderContainer\n    }, [\n        m('div', {\n            class: CSS_CLASSES.backgroundContainer\n        }, [\n            m('div', {class: CSS_CLASSES.condensedBackground}),\n            m('div', {class: CSS_CLASSES.headerBackground}),\n            m('div', {class: CSS_CLASSES.mediaDimmer})\n        ]),\n        header,\n        (ctrl.mode === 'seamed' || ctrl.shadow === false) ? null : m('div', {class: CSS_CLASSES.dropShadow})\n    ]);\n};\n\nconst createViewContent = (ctrl, scrollConfig, opts = {}) => {\n    const initMainContainer = (mainContainer, inited) => {\n        if (inited) {\n            return;\n        }\n        if (scrollConfig.main) {\n            ctrl.scrollerElem = mainContainer;\n        }\n    };\n    return [\n        m('div', {\n            class: CSS_CLASSES.mainContainer,\n            config: initMainContainer,\n            onscroll: (e) => {\n                scrollConfig.main(e);\n                events.emit('scroll', e);\n                ctrl.storeScrollPosition(e.target.scrollTop);\n            }\n        },\n        opts.content ? opts.content : null)\n    ];\n};\n\nconst createView = (ctrl, opts = {}) => {\n    opts.header = opts.header || {};\n    opts.configs = opts.configs || [];\n    ctrl.init(ctrl);\n\n    const updateContentOnScroll = opts.updateContentOnScroll || false;\n    const ignoreContent = !updateContentOnScroll && ctrl.isScrolling;\n    const scrollerType = modeConfigs.outerScroll[ctrl.mode] ? 'outer' : 'main';\n    const handleScroll = ctrl.handleScroll.bind(ctrl);\n    const header = createViewHeader(ctrl, opts);\n    const tag = opts.tag || 'div';\n\n    const scrollConfig = {};\n    scrollConfig[scrollerType] = handleScroll;\n\n    const initOuterContainer = (outerContainer, inited) => {\n        const headerElem = outerContainer.querySelector('.' + CSS_CLASSES.header) || outerContainer.querySelector('.' + CSS_CLASSES.toolbar);\n        if (!headerElem) {\n            return;\n        }\n        if (inited && ctrl.headerElem) {\n            return;\n        }\n        const headerContainer = outerContainer.querySelector('.' + CSS_CLASSES.headerContainer);\n        const topBarElem = headerContainer.querySelector('.' + CSS_CLASSES.toolbarTopbar);\n        const headerBg = headerContainer.querySelector('.' + CSS_CLASSES.headerBackground);\n        const condensedHeaderBg = headerContainer.querySelector('.' + CSS_CLASSES.condensedBackground);\n\n        ctrl.outerContainerElem = outerContainer;\n        ctrl.headerElem = headerElem;\n        ctrl.headerTopBarElem = topBarElem;\n        ctrl.headerBg = headerBg;\n        ctrl.condensedHeaderBg = condensedHeaderBg;\n\n        if (!opts.animated) {\n            ctrl.setHeight(headerContainer.clientHeight);\n        }\n        if (scrollConfig.outer) {\n            ctrl.scrollerElem = outerContainer;\n        }\n\n        ctrl.restoreScrollPosition();\n    };\n\n    const props = Object.assign({}, {\n        class: [\n            CSS_CLASSES.panel,\n            ctrl.fixed ? CSS_CLASSES.fixed : null,\n            classForMode(ctrl.mode),\n            opts.class\n        ].join(' '),\n        id: opts.id || '',\n        config: (el, inited) => {\n            if (inited) {\n                return;\n            }\n            ctrl.headerPanelElem = el;\n        }\n    });\n\n    const content = m('div', {\n        class: CSS_CLASSES.outerContainer,\n        config: initOuterContainer,\n        onscroll: (e) => {\n            scrollConfig.outer(e);\n            events.emit('scroll', e);\n        }\n    }, [\n        header,\n        ignoreContent ? {\n            subtree: 'retain'\n        } : createViewContent(ctrl, scrollConfig, opts)\n    ]);\n    return m(tag, props, [opts.before, content, opts.after]);\n};\n\nconst component = {\n    controller: (opts = {}) => {\n        let ctrl,\n            mode,\n            y,\n            scrolled,\n            prevScrollTop,\n            headerMargin,\n            headerHeight;\n\n        if (opts.mode) {\n            mode = opts.mode;\n        } else if (opts.header && opts.header.toolbar) {\n            mode = opts.header.toolbar.mode;\n        } else if (opts.header && opts.header.content) {\n            mode = opts.header.mode;\n        }\n        mode = mode || 'standard';\n        const tall = modeConfigs.tallMode[mode] || false;\n        const tallClass = opts.tallClass || CSS_CLASSES.headerTall;\n        const animated = opts.animated || false;\n        const fixed = opts.fixed || false;\n        const condenses = opts.condenses || false;\n        const scrollAwayTopbar = opts.scrollAwayTopbar || false;\n        const noReveal = opts.noReveal || false;\n        const keepCondensedHeader = opts.keepCondensedHeader || false;\n        const noDissolve = opts.noDissolve || false;\n        const backgroundScrollSpeed = (opts.backgroundScrollSpeed !== undefined) ? opts.backgroundScrollSpeed : 0.5;\n        y = 0;\n        scrolled = false;\n        prevScrollTop = 0;\n        // defaults, finally set with setHeight\n        const shadowHeight = DEFAULT_SHADOW_HEIGTH;\n        headerHeight = (opts.headerHeight || DEFAULT_HEADER_HEIGHT) + shadowHeight;\n        const condensedHeaderHeight = (opts.condensedHeaderHeight || DEFAULT_CONDENSED_HEADER_HEIGHT) + shadowHeight;\n        headerMargin = headerHeight - condensedHeaderHeight;\n\n        const handleScrollFns = {\n            standard: () => {\n                //\n            },\n            fixed: () => {\n                const isScrolled = (ctrl.scrollerElem.scrollTop > 0);\n                ctrl.showShadow(isScrolled);\n                scrolled = isScrolled;\n            },\n            animated: () => {\n                const isScrolled = (ctrl.scrollerElem.scrollTop > 0);\n                if (isScrolled !== scrolled) {\n                    const headerElem = ctrl.headerElem;\n                    if (headerElem && tall) {\n                        headerElem.classList[isScrolled ? 'remove' : 'add'](tallClass);\n                    }\n                    ctrl.showShadow(isScrolled);\n                    scrolled = isScrolled;\n                }\n            },\n            dynamicHeader: () => {\n                let sy,\n                    cascaded = false,\n                    sTop;\n\n                if (!ctrl.scrollInited && opts.initialScrollPosition) {\n                    sTop = opts.initialScrollPosition;\n                } else {\n                    sTop = ctrl.scrollerElem.scrollTop;\n                }\n \n                if (!ctrl.scrollInited && opts.initialPositionFixed) {\n                    prevScrollTop = sTop;\n                    y = 0;\n                    return;\n                }\n\n                if (sTop < headerMargin) {\n                    sy = sTop;\n                } else {\n                    sy = Math.min(keepCondensedHeader\n                            ? headerMargin\n                            : headerHeight,\n                        Math.max(0, ((noReveal || keepCondensedHeader)\n                            ? sTop\n                            : y + sTop - prevScrollTop))\n                    );\n                    if (condenses && prevScrollTop >= sTop && sTop > headerMargin) {\n                        sy = Math.max(sy, headerMargin);\n                    }\n                }\n                if (sTop > 0) {\n                    ctrl.transformHeader(sy);\n                } else if (p.isTouch) {\n                    ctrl.enlargeImage(sy);\n                }\n                if (!modeConfigs.noShadow[opts.mode]) {\n                    if (sTop > sy) {\n                        cascaded = true;\n                    }\n                    ctrl.showShadow(cascaded);\n                }\n                y = sy;\n                prevScrollTop = Math.max(sTop, 0);\n            }\n        };\n\n        let handleScrollFn;\n        if (animated) {\n            handleScrollFn = handleScrollFns.animated;\n        } else if (mode === 'standard') {\n            handleScrollFn = handleScrollFns.standard;\n        } else if (fixed) {\n            handleScrollFn = handleScrollFns.fixed;\n        } else {\n            handleScrollFn = handleScrollFns.dynamicHeader;\n        }\n\n        return {\n            headerPanelElem: undefined,\n            scrollerElem: undefined,\n            outerContainerElem: undefined,\n            headerContainerElem: undefined,\n            headerTopBarElem: undefined,\n            headerElem: undefined,\n            headerBg: undefined,\n            condensedHeaderBg: undefined,\n            mode: mode,\n            fixed: fixed,\n            shadow: (opts.shadow !== undefined && !opts.shadow) ? false : true,\n            scrollWatchId: 0,\n            isScrolling: false,\n            scrollInited: false,\n            headerConfig: {\n                tall: tall,\n                tallClass: tallClass,\n                animated: animated,\n                fixed: fixed\n            },\n\n            init: (controller) => {\n                ctrl = controller;\n            },\n\n            setHeight: (h) => {\n                if (opts.headerHeight === undefined) {\n                    headerHeight = h + shadowHeight;\n                    headerMargin = headerHeight - condensedHeaderHeight;\n                }\n                if (!fixed) {\n                    const mainContainer = ctrl.outerContainerElem.querySelector('.' + CSS_CLASSES.mainContainer);\n                    mainContainer.style.paddingTop = h + 'px';\n                }\n                if (noReveal) {\n                    ctrl.showShadow(false);\n                }\n            },\n\n            handleScroll: (e) => {\n                if (e) {\n                    // this is a real scroll event\n                    // instead of a programmatic call\n                    ctrl.isScrolling = true;\n                    scroller = ctrl;\n                    clearTimeout(ctrl.scrollWatchId);\n                    ctrl.scrollWatchId = setTimeout(() => {\n                        ctrl.isScrolling = false;\n                        scroller = undefined;\n                    }, SCROLL_WATCH_TIMER);\n                }\n\n                if (mode === 'scroll') {\n                    return;\n                }\n                if (modeConfigs.alwaysShadow[mode]) {\n                    ctrl.showShadow(true);\n                }\n\n                handleScrollFn();\n                ctrl.scrollInited = true;\n\n                if (e && opts.scroll) {\n                    opts.scroll(e);\n                }\n            },\n\n            condenseHeader: (hy) => {\n                const reset = (hy === null);\n\n                // adjust top bar in core-header so the top bar stays at the top\n                if (!scrollAwayTopbar) {\n                    if (ctrl.headerTopBarElem) {\n                        translateY(ctrl.headerTopBarElem.style, Math.min(hy, headerMargin));\n                    }\n                }\n\n                // transition header bg\n                const hbg = ctrl.headerBg.style;\n                if (hbg) {\n                    if (!noDissolve) {\n                        hbg.opacity = reset ? '' : (headerMargin - hy) / headerMargin;\n                    }\n\n                    // adjust header bg so it stays at the center\n                    translateY(hbg, reset ? null : hy * backgroundScrollSpeed);\n\n                    // transition condensed header bg\n                    if (!noDissolve) {\n                        const chbg = ctrl.condensedHeaderBg.style;\n                        chbg.opacity = reset ? '' : hy / headerMargin;\n                        // adjust condensed header bg so it stays at the center\n                        translateY(chbg, reset ? null : hy * backgroundScrollSpeed);\n                    }\n                }\n            },\n\n            transformHeader: (hy) => {\n                if (hy < 0) {\n                    return;\n                }\n                translateY(ctrl.headerContainerElem.style, -hy);\n                if (condenses) {\n                    ctrl.condenseHeader(hy);\n                }\n                if (opts.transform) {\n                    opts.transform({\n                        y: hy,\n                        height: headerHeight,\n                        condensedHeight: condensedHeaderHeight\n                    });\n                }\n            },\n\n            enlargeImage: (hy) => {\n                ctrl.headerBg.style.height = 100 / headerHeight * (headerHeight + Math.abs(hy / 2)) + '%';\n            },\n\n            showShadow: (cascaded) => {\n                if (modeConfigs.alwaysShadow[mode]) {\n                    cascaded = true;\n                }\n                ctrl.outerContainerElem.classList[cascaded ? 'add' : 'remove'](CSS_CLASSES.cascaded);\n            },\n\n            storeScrollPosition: (scrollTop) => {\n                if (opts.restoreScrollPositionId) {\n                    scrollPositions[opts.restoreScrollPositionId] = scrollTop;\n                }\n            },\n\n            restoreScrollPosition: () => {\n                if (opts.restoreScrollPositionId) {\n                    const scrollTop = scrollPositions[opts.restoreScrollPositionId];\n                    if (scrollTop !== undefined) {\n                        const restore = () => (ctrl.scrollerElem.scrollTop = scrollTop);\n                        restore();\n                        setTimeout(restore, 0);\n                    }\n                }\n            }\n        };\n    },\n\n    view: (ctrl, opts) => {\n        if (scroller && scroller !== ctrl) {\n            // if we are scrolling,\n            // don't render other header-panels\n            return {\n                subtree: 'retain'\n            };\n        } else {\n            return createView(ctrl, opts);\n        }\n    }\n};\n\nexport default component;\n"]}