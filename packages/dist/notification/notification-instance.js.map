{"version":3,"sources":["../../src/src/notification/notification-instance.js"],"names":["CSS_CLASSES","content","title","multilineTitle","action","horizontal","vertical","DEFAULT_TIME_OUT","pause","ctrl","isPaused","timer","unpause","resume","stopTimer","stop","show","opts","id","instanceId","isTransitioning","transitions","then","didShow","timeout","timeoutSeconds","undefined","hide","didHide","redraw","createView","tag","props","class","layout","join","config","el","inited","context","vdom","containerEl","document","querySelector","containerSelector","onclick","e","preventDefault","titleConfig","height","getBoundingClientRect","lineHeight","parseInt","window","getComputedStyle","paddingTop","paddingBottom","classList","add","component","controller","instanceData","dismissEl","view"],"mappings":"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","file":"notification-instance.js","sourcesContent":["import '../common/object.assign';\nimport m from 'mithril';\nimport Timer from '../common/timer';\nimport transition from '../common/transition';\n\nconst CSS_CLASSES = {\n    content: 'pe-notification__content',\n    title: 'pe-notification__title',\n    multilineTitle: 'pe-notification__title--multiline',\n    action: 'pe-notification__action',\n    horizontal: 'pe-notification--horizontal',\n    vertical: 'pe-notification--vertical'\n};\n\nconst DEFAULT_TIME_OUT = 3;\n\nconst pause = (ctrl) => {\n    ctrl.isPaused = true;\n    if (ctrl.timer) {\n        ctrl.timer.pause();\n    }\n};\n\nconst unpause = (ctrl) => {\n    ctrl.isPaused = false;\n    if (ctrl.timer) {\n        ctrl.timer.resume();\n    }\n};\n\nconst stopTimer = (ctrl) => {\n    if (ctrl.timer) {\n        ctrl.timer.stop();\n    }\n};\n\nconst show = (ctrl, opts) => {\n    stopTimer(ctrl);\n    const id = ctrl.instanceId;\n    ctrl.isTransitioning = true;\n    return transition.show(Object.assign(\n        {},\n        opts,\n        ctrl.transitions.show(ctrl, opts)\n    )).then(() => {\n        ctrl.isTransitioning = false;\n        if (ctrl.didShow) {\n            // notify multiple\n            ctrl.didShow(id);\n            // this will call opts.didShow\n        }\n\n        // set timer to hide in a few seconds\n        const timeout = opts.timeout;\n        if (timeout === 0) {\n            // do not time out\n        } else {\n            const timeoutSeconds = (timeout !== undefined) ? timeout : DEFAULT_TIME_OUT;\n            ctrl.timer = new Timer(() => {\n                hide(ctrl, opts);\n            }, timeoutSeconds * 1000);\n        }\n    });\n};\n\nconst hide = (ctrl, opts) => {\n    stopTimer(ctrl);\n    const id = ctrl.instanceId;\n    ctrl.isTransitioning = true;\n    return transition.hide(Object.assign(\n        {},\n        opts,\n        ctrl.transitions.hide(ctrl, opts)\n    )).then(() => {\n        stopTimer(ctrl);\n        ctrl.isTransitioning = false;\n        if (ctrl.didHide) {\n            // notify multiple\n            ctrl.didHide(id);\n            // this will call opts.didHide\n        }\n        m.redraw(); // removes remainder of drawn component\n    });\n};\n\nconst createView = (ctrl, opts = {}) => {\n    const tag = opts.tag || 'div';\n    const props = {\n        class: [ctrl.class, (opts.layout === 'vertical' ? CSS_CLASSES.vertical : CSS_CLASSES.horizontal), opts.class].join(' '),\n        id: opts.id || '',\n        config: (el, inited, context, vdom) => {\n            if (inited) return;\n            if (opts.config) {\n                opts.config(el, inited, context, vdom);\n            }\n            ctrl.el = el;\n\n            // container element is used for transitioning the notification\n            ctrl.containerEl = document.querySelector(opts.containerSelector || '.pe-notification__holder');\n            show(ctrl, opts);\n        },\n        onclick: (e) => {\n            e.preventDefault();\n        }\n    };\n    const titleConfig = (el, inited) => {\n        if (inited) return;\n        const height = el.getBoundingClientRect().height;\n        const lineHeight = parseInt(window.getComputedStyle(el).lineHeight, 10);\n        const paddingTop = parseInt(window.getComputedStyle(el).paddingTop, 10);\n        const paddingBottom = parseInt(window.getComputedStyle(el).paddingBottom, 10);\n        if (height > (lineHeight + paddingTop + paddingBottom)) {\n            el.classList.add(CSS_CLASSES.multilineTitle);\n        }\n    };\n    const title = opts.title;\n    const content = m('div', {\n        class: CSS_CLASSES.content\n    }, [\n        title ? m('div', {\n            class: CSS_CLASSES.title,\n            config: titleConfig\n        }, title) : null,\n        opts.action ? m('div', {\n            class: CSS_CLASSES.action\n        }, [\n            opts.action\n        ]) : null\n    ]);\n    return m(tag, props, content);\n};\n\nconst component = {\n    controller: (instanceData = {}) => {\n        // instanceData contains {id, opts}\n        return Object.assign({}, instanceData, {\n            el: null,\n            containerEl: null,\n            dismissEl: null,\n            isTransitioning: false,\n            timer: null,\n            isPaused: false\n        });\n    },\n    view: (ctrl, instanceData) => {\n        // instanceData contains {id, opts}\n        const opts = (typeof instanceData.opts === 'function')\n            ? instanceData.opts()\n            : instanceData.opts;\n        if (instanceData.hide && !ctrl.isTransitioning) {\n            hide(ctrl, opts);\n        }\n        if (instanceData.pause && !ctrl.isPaused) {\n            pause(ctrl, opts);\n        } else if (instanceData.unpause && ctrl.isPaused) {\n            unpause(ctrl, opts);\n        }\n        return createView(ctrl, opts);\n    }\n};\n\nexport default component;\n"]}