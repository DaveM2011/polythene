{"version":3,"sources":["../../src/src/common/multiple.js"],"names":["multiple","mOpts","items","itemIndex","id","item","findItem","indexOf","removeItem","index","splice","replaceItem","newItem","i","length","instanceId","next","show","redraw","remove","queue","shift","setTimeout","setPauseState","pause","unpause","makeItem","itemOpts","resolveShow","didShow","opts","showPromise","Promise","resolve","resolveHide","didHide","hidePromise","count","clear","defaultId","push","storedItem","hide","view","toShowItems","filter","document","body","classList","bodyShowClass","noneTag","add","tag","map","itemData","instance","transitions","key"],"mappings":"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","file":"multiple.js","sourcesContent":["/*\nHelper module to manage multiple items of the same component type.\n*/\nimport m from 'mithril';\nimport './object.assign';\n\n/*\nmOpts:\n- instance\n- defaultId\n- tag\n- noneTag\n- bodyShowClass\n*/\nconst multiple = (mOpts) => {\n    const items = [];\n\n    const itemIndex = (id) => {\n        const item = findItem(id);\n        return items.indexOf(item);\n    };\n\n    const removeItem = (id) => {\n        const index = itemIndex(id);\n        if (index !== -1) {\n            items.splice(index, 1);\n        }\n    };\n\n    const replaceItem = (id, newItem) => {\n        const index = itemIndex(id);\n        if (index !== -1) {\n            items[index] = newItem;\n        }\n    };\n\n    const findItem = (id) => {\n        // traditional for loop for IE10\n        for (let i = 0; i < items.length; i++) {\n            if (items[i].instanceId === id) {\n                return items[i];\n            }\n        }\n    };\n\n    const next = () => {\n        if (items.length) {\n            items[0].show = true;\n            m.redraw();\n        }\n    };\n\n    const remove = (instanceId) => {\n        if (mOpts.queue) {\n            items.shift();\n            // add time to remove the previous instance before drawing the next one\n            setTimeout(next, 0);\n        } else {\n            removeItem(instanceId);\n        }\n    };\n\n    const setPauseState = (pause, instanceId) => {\n        const item = findItem(instanceId);\n        if (item) {\n            item.pause = pause;\n            item.unpause = !pause;\n        }\n    };\n\n    const makeItem = (itemOpts, instanceId) => {\n        let resolveShow;\n        const didShow = () => {\n            const opts = (typeof itemOpts === 'function')\n                ? itemOpts()\n                : itemOpts;\n            if (opts.didShow) {\n                opts.didShow(instanceId);\n            }\n            return resolveShow(instanceId);\n        };\n        const showPromise = new Promise(function(resolve) {\n            resolveShow = resolve;\n        });\n\n        let resolveHide;\n        const didHide = () => {\n            const opts = (typeof itemOpts === 'function')\n                ? itemOpts()\n                : itemOpts;\n            if (opts.didHide) {\n                opts.didHide(instanceId);\n            }\n            if (mOpts.queue) {\n                remove(instanceId);\n            }\n            return resolveHide(instanceId);\n        };\n        const hidePromise = new Promise(function(resolve) {\n            resolveHide = resolve;\n        });\n\n        return Object.assign({}, mOpts, {\n            instanceId,\n            opts: itemOpts,\n            show: mOpts.queue ? false : true,\n            showPromise,\n            hidePromise,\n            didShow,\n            didHide\n        });\n    };\n\n    return {\n\n        count: () => (items.length),\n\n        clear: () => (items.length = 0),\n\n        show: (opts, instanceId = mOpts.defaultId) => {\n            let item;\n            if (mOpts.queue) {\n                item = makeItem(opts, instanceId);\n                items.push(item);\n                if (items.length === 1) {\n                    next();\n                }\n            } else {\n                const storedItem = findItem(instanceId);\n                item = makeItem(opts, instanceId);\n                if (!storedItem) {\n                    items.push(item);\n                } else {\n                    replaceItem(instanceId, item);\n                }\n            }\n            return item.showPromise;\n        },\n\n        hide: (instanceId = mOpts.defaultId) => {\n            let item;\n            if (mOpts.queue) {\n                if (items.length) {\n                    item = items[0];\n                }\n            } else {\n                item = findItem(instanceId);\n            }\n            if (item) {\n                item.hide = true;\n                return item.hidePromise;\n            }\n            return Promise.resolve(instanceId);\n        },\n\n        remove: (instanceId = mOpts.defaultId) => {\n            remove(instanceId);\n        },\n\n        pause: (instanceId = mOpts.defaultId) => {\n            setPauseState(true, instanceId);\n        },\n\n        unpause: (instanceId = mOpts.defaultId) => {\n            setPauseState(false, instanceId);\n        },\n\n        view: () => {\n            const toShowItems = items.filter((item) => {\n                return item.show;\n            });\n            if (!toShowItems.length) {\n                document.body.classList.remove(mOpts.bodyShowClass);\n                // placeholder because we cannot return null\n                return m(mOpts.noneTag);\n            } else {\n                document.body.classList.add(mOpts.bodyShowClass);\n            }\n            return m(mOpts.tag, toShowItems.map((itemData) => {\n                return m(mOpts.instance, Object.assign({}, itemData, {\n                    transitions: mOpts.transitions,\n                    key: itemData.key || itemData.instanceId\n                }));\n            }));\n        }\n    };\n};\n\nexport default multiple;\n"]}