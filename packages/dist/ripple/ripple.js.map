{"version":3,"sources":["../../src/src/ripple/ripple.js"],"names":["transitionEvent","DEFAULT_START_OPACITY","OPACITY_DECAY_VELOCITY","CSS_CLASSES","ripple","waves","mask","constrained","animated","makeRipple","e","ctrl","opts","el","wavesEl","w","offsetWidth","h","offsetHeight","waveRadius","Math","sqrt","rect","getBoundingClientRect","x","isTouch","touches","pageX","clientX","y","pageY","clientY","mx","center","left","width","my","top","height","rx","ry","initialOpacity","undefined","opacityDecayVelocity","duration","color","window","getComputedStyle","onEnd","evt","classList","remove","removeEventListener","end","style","backgroundColor","opacity","addEventListener","start","add","createView","disabled","initRipple","inited","context","parent","parentElement","inactive","onClick","endType","onunload","initWaves","tag","props","class","join","id","config","content","component","controller","prop","delegate","view"],"mappings":"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","file":"ripple.js","sourcesContent":["import m from 'mithril';\nimport p from '../polythene/polythene';\nimport whichTransitionEvent from '../common/transition-event';\nimport './theme';\n\nconst transitionEvent = whichTransitionEvent();\nconst DEFAULT_START_OPACITY = 0.2;\nconst OPACITY_DECAY_VELOCITY = 0.35;\n\nconst CSS_CLASSES = {\n    ripple: 'pe-ripple',\n    waves: 'pe-ripple__waves',\n    mask: 'pe-ripple__mask',\n    constrained: 'pe-ripple--constrained',\n    animated: 'pe-ripple__waves--animated'\n};\n\nconst makeRipple = (e, ctrl, opts = {}) => {\n    const el = ctrl.ripple();\n    const wavesEl = ctrl.waves();\n    const w = el.offsetWidth;\n    const h = el.offsetHeight;\n    const waveRadius = Math.sqrt(w * w + h * h);\n    const rect = el.getBoundingClientRect();\n    const x = (p.isTouch && e.touches) ? e.touches[0].pageX : e.clientX;\n    const y = (p.isTouch && e.touches) ? e.touches[0].pageY : e.clientY;\n    const mx = (opts.center) ? (rect.left + rect.width / 2) : x;\n    const my = (opts.center) ? (rect.top + rect.height / 2) : y;\n    const rx = mx - rect.left - waveRadius / 2;\n    const ry = my - rect.top - waveRadius / 2;\n    const initialOpacity = (opts.initialOpacity !== undefined) ? opts.initialOpacity : DEFAULT_START_OPACITY;\n    const opacityDecayVelocity = (opts.opacityDecayVelocity !== undefined) ? opts.opacityDecayVelocity : OPACITY_DECAY_VELOCITY;\n    const duration = 1 / opacityDecayVelocity * initialOpacity;\n    const color = window.getComputedStyle(el).color;\n    const onEnd = function(evt) {\n        wavesEl.classList.remove(CSS_CLASSES.animated);\n        wavesEl.removeEventListener(transitionEvent, onEnd, false);\n        if (opts.end) {\n            opts.end(evt);\n        }\n    };\n\n    wavesEl.classList.remove(CSS_CLASSES.animated);\n    const style = wavesEl.style;\n    style.width = style.height = waveRadius + 'px';\n    style.top = ry + 'px';\n    style.left = rx + 'px';\n    style['animation-duration'] =\n        style['-webkit-animation-duration'] =\n        style['-moz-animation-duration'] =\n        style['-o-animation-duration'] = duration + 's';\n    style.backgroundColor = color;\n    style.opacity = initialOpacity;\n    wavesEl.addEventListener(transitionEvent, onEnd, false);\n\n    if (opts.start) {\n        opts.start(e);\n    }\n    wavesEl.classList.add(CSS_CLASSES.animated);\n};\n\nconst createView = (ctrl, opts = {}) => {\n    if (opts.disabled) {\n        return m('');\n    }\n    const initRipple = (el, inited, context) => {\n        if (inited) {\n            return;\n        }\n        ctrl.ripple(el);\n        const parent = el.parentElement;\n        if (!opts.inactive) {\n            const onClick = (e) => {\n                makeRipple(e, ctrl, opts);\n            };\n            const endType = p.isTouch ? 'click' : 'mouseup';\n            parent.addEventListener(endType, onClick, false);\n            context.onunload = () => {\n                parent.removeEventListener(endType, onClick, false);\n            };\n        }\n    };\n    const initWaves = (waves, inited) => {\n        if (inited) {\n            return;\n        }\n        ctrl.waves(waves);\n\n    };\n    const tag = opts.tag || 'div';\n    const props = {\n        class: [\n            CSS_CLASSES.ripple,\n            (opts.constrained !== false ? CSS_CLASSES.constrained : null),\n            opts.class\n        ].join(' '),\n        id: opts.id || '',\n        config: initRipple\n    };\n    const content = m('div', {\n        class: CSS_CLASSES.mask\n    }, m('div',\n        {\n            class: CSS_CLASSES.waves,\n            config: initWaves\n        })\n    );\n    return m(tag, props, content);\n};\n\nconst component = {\n    controller: () => {\n        return {\n            ripple: m.prop(),\n            waves: m.prop(),\n            delegate: m.prop()\n        };\n    },\n    view: (ctrl, opts = {}) => {\n        return createView(ctrl, opts);\n    }\n};\n\nexport default component;\n"]}