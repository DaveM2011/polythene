{"version":3,"sources":["../../src/src/button/button.js"],"names":["CSS_CLASSES","block","content","label","raised","wash","focus","selected","disabled","borders","inactive","focusState","MAX_Z","startType","window","PointerEvent","DocumentTouch","document","endType","tapStart","tapEnd","tapEndAll","downButtons","animateZ","ctrl","opts","name","baseZ","increase","z","Math","min","max","redraw","inactivate","setTimeout","initTapEvents","el","tapHandler","push","animateOnTap","isTouch","map","btn","addEventListener","clearTapEvents","removeEventListener","createView","noink","ink","undefined","tag","tabIndex","tabindex","buttonConfig","isInited","context","onunload","optsConfig","config","urlConfig","url","props","class","parentClass","join","id","onfocus","mouseover","onblur","onmouseover","onmouseout","onkeydown","e","which","event","MouseEvent","view","bubbles","cancelable","dispatchEvent","formaction","type","events","noWash","rippleOpts","ripple","animated","before","after","component","controller","prop"],"mappings":"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","file":"button.js","sourcesContent":["import '../common/object.assign';\nimport p from '../polythene/polythene';\nimport m from 'mithril';\nimport ripple from '../ripple/ripple';\nimport shadow from '../shadow/shadow';\nimport '../base-button/base-button';\nimport './theme';\n\nconst CSS_CLASSES = {\n    block: 'pe-button pe-button--text',\n    content: 'pe-button__content',\n    label: 'pe-button__label',\n    raised: 'pe-button--raised',\n    wash: 'pe-button__wash',\n    focus: 'pe-button__focus',\n    selected: 'pe-button--selected',\n    disabled: 'pe-button--disabled',\n    borders: 'pe-button--borders',\n    inactive: 'pe-button--inactive',\n    focusState: 'pe-button--focus',\n};\n\nconst MAX_Z = 5;\n\nconst startType = window.PointerEvent ? 'pointerdown' : (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) ? 'touchstart' : 'mousedown';\nconst endType = window.PointerEvent ? 'pointerup' : (('ontouchend' in window) || window.DocumentTouch && document instanceof DocumentTouch) ? 'touchend' : 'mouseup';\n\nlet tapStart,\n    tapEnd,\n    tapEndAll,\n    downButtons = [];\n\nconst animateZ = (ctrl, opts, name) => {\n    const baseZ = ctrl.baseZ();\n    const increase = opts.increase || 1;\n    let z = ctrl.z();\n    if (name === 'down' && baseZ !== 5) {\n        z = z + increase;\n        z = Math.min(z, MAX_Z);\n    } else if (name === 'up') {\n        z = z - increase;\n        z = Math.max(z, baseZ);\n    }\n    if (z !== ctrl.z()) {\n        ctrl.z(z);\n        m.redraw(); // make animation visible\n    }\n};\n\nconst inactivate = (ctrl, opts) => {\n    ctrl.inactive = true;\n    m.redraw();\n    setTimeout(() => {\n        ctrl.inactive = false;\n        m.redraw();\n    }, opts.inactivate * 1000);\n};\n\nconst initTapEvents = (el, ctrl, opts) => {\n    const tapHandler = (ctrl, opts, name) => {\n        if (name === 'down') {\n            downButtons.push({ctrl, opts});\n        } else if (name === 'up') {\n            if (opts.inactivate && !ctrl.inactive) {\n                inactivate(ctrl, opts);\n            }\n        }\n        // no z animation on touch\n        if (opts.animateOnTap && !p.isTouch) {\n            animateZ(ctrl, opts, name);\n        }\n    };\n    tapStart = () => (tapHandler(ctrl, opts, 'down'));\n    tapEnd = () => (tapHandler(ctrl, opts, 'up'));\n    tapEndAll = () => {\n        downButtons.map((btn) => {\n            tapHandler(btn.ctrl, btn.opts, 'up');\n        });\n        downButtons = [];\n    };\n    el.addEventListener(startType, tapStart);\n    el.addEventListener(endType, tapEnd);\n    window.addEventListener(endType, tapEndAll);\n};\n\nconst clearTapEvents = function(el) {\n    el.removeEventListener(startType, tapStart);\n    el.removeEventListener(endType, tapEnd);\n    window.removeEventListener(endType, tapEndAll);\n};\n\nconst createView = (ctrl, opts = {}) => {\n    const noink = (opts.ink !== undefined && opts.ink === false);\n    const disabled = opts.disabled;\n    const tag = opts.tag || 'a';\n    ctrl.inactive = (opts.inactive !== undefined)\n        ? (opts.inactive === false)\n            ? false\n            : true\n        : ctrl.inactive;\n    const tabIndex = (disabled || ctrl.inactive)\n        ? -1\n        : opts.tabindex || 0;\n\n    // handle multiple configs:\n    // - passed as param in the url Object\n    // - passed as opts.config\n    // - the default button config\n    const buttonConfig = (el, isInited, context) => {\n        if (isInited) {\n            return;\n        }\n        ctrl.el = el;\n        if (!disabled && !ctrl.inactive) {\n            initTapEvents(el, ctrl, Object.assign(\n                {},\n                opts,\n                {animateOnTap: (opts.animateOnTap !== false) ? true : false}\n            ));\n            context.onunload = () => {\n                clearTapEvents(el);\n            };\n        }\n    };\n    const optsConfig = opts.config || (() => {});\n    const urlConfig = (opts.url && opts.url.config) ? opts.url.config : (() => {});\n\n    const props = Object.assign(\n        {},\n        {\n            class: [\n                (opts.parentClass || CSS_CLASSES.block),\n                (opts.selected ? CSS_CLASSES.selected : null),\n                (disabled ? CSS_CLASSES.disabled : null),\n                (ctrl.inactive ? CSS_CLASSES.inactive : null),\n                (opts.borders ? CSS_CLASSES.borders : null),\n                (opts.raised ? CSS_CLASSES.raised : null),\n                (ctrl.focus ? CSS_CLASSES.focusState : null),\n                opts.class\n            ].join(' '),\n            id: opts.id || '',\n            tabindex: tabIndex,\n            // handle focus events\n            onfocus: () => ctrl.focus = !ctrl.mouseover,\n            onblur: () => ctrl.focus = false,\n            // don't show focus on click (detected by not being in mouse over state)\n            onmouseover: () => ctrl.mouseover = true,\n            onmouseout: () => ctrl.mouseover = false,\n            // if focus, dispatch click event on ENTER\n            onkeydown: (e) => {\n                if (e.which === 13 && ctrl.focus && ctrl.el) {\n                    // ENTER\n                    const event = new MouseEvent('click', {\n                        view: window,\n                        bubbles: true,\n                        cancelable: true\n                    });\n                    ctrl.el.dispatchEvent(event);\n                }\n            }\n        },\n        opts.url ? opts.url : null,\n        opts.formaction ? {formaction: opts.formaction} : null,\n        opts.type ? {type: opts.type} : null,\n        opts.events ? opts.events : null,\n        {\n            config: (...args) => [\n                buttonConfig(...args),\n                optsConfig(...args),\n                urlConfig(...args)\n            ]\n        },\n        disabled\n            ? {\n                disabled: true\n            }\n            : null\n    );\n\n    const label = opts.content\n        ? opts.content\n        : (opts.label)\n            ? (typeof opts.label === 'object')\n                ? opts.label\n                : m('div', {class: CSS_CLASSES.label}, opts.label)\n            : null;\n\n    const noWash = disabled || (opts.wash !== undefined && !opts.wash);\n    const wash = !noWash;\n    const rippleOpts = Object.assign(\n        {},\n        opts.ripple,\n        {inactive: noink}\n    );\n    const content = m('div', {\n        'class': CSS_CLASSES.content\n    }, [\n        (opts.raised && !disabled)\n            ? m(shadow, {\n                z: ctrl.z(),\n                animated: true\n            })\n            : null,\n        // ripple\n        disabled ? null : m(ripple, rippleOpts),\n        // hover\n        wash ? m('div', {class: CSS_CLASSES.wash}) : null,\n        // focus\n        disabled ? null : m('div', {class: CSS_CLASSES.focus}),\n        label\n    ]);\n    return m(tag, props, [opts.before, content, opts.after]);\n};\n\nconst component = {\n    controller: (opts = {}) => {\n        let z = (opts.z !== undefined) ? opts.z : 1;\n\n        return {\n            el: undefined,\n            baseZ: m.prop(z),\n            z: m.prop(z),\n            inactive: undefined,\n            focus: false,\n            mouseover: false\n        };\n    },\n    view: (ctrl, opts = {}) => {\n        return createView(ctrl, opts);\n    }\n};\n\nexport default component;\n"]}